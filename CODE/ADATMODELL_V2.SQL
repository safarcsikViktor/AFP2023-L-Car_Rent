-- Generated by Oracle SQL Developer Data Modeler 22.2.0.165.1149
--   at:        2023-04-22 11:04:12 CEST
--   site:      Oracle Database 11g
--   type:      Oracle Database 11g



-- predefined type, no DDL - MDSYS.SDO_GEOMETRY

-- predefined type, no DDL - XMLTYPE

CREATE TABLE admin (
    admin_id              NUMBER NOT NULL,
    profile_id            NUMBER,
    employee_id           NUMBER,
    permission_type       VARCHAR2(10) NOT NULL,
    permission_start_date DATE NOT NULL,
    permission_end_date   DATE NOT NULL
);

COMMENT ON TABLE admin IS
    'A táblában a jogosultsági szintek adatait tároljuk.';

COMMENT ON COLUMN admin.admin_id IS
    'A tábla egyedi azonosítója';

COMMENT ON COLUMN admin.profile_id IS
    'Regisztrált felhasználó egyedi azonosítója';

COMMENT ON COLUMN admin.employee_id IS
    'Munkaválló egyedi azonosítója';

COMMENT ON COLUMN admin.permission_type IS
    'Engedély típusa';

COMMENT ON COLUMN admin.permission_start_date IS
    'Engedély kezdete';

COMMENT ON COLUMN admin.permission_end_date IS
    'Engedély lejárata';

ALTER TABLE admin ADD CONSTRAINT admin_pk PRIMARY KEY ( admin_id );

CREATE TABLE car (
    car_id NUMBER NOT NULL,
    status CHAR(1) NOT NULL,
    photo  BLOB
);

COMMENT ON TABLE car IS
    'A táblában a gépjármű azonosító adatait és elérhetőségét tároljuk.';

COMMENT ON COLUMN car.car_id IS
    'Gépjármű egyedi azonosítója';

COMMENT ON COLUMN car.status IS
    'Gépjármű aktuális státusza';

COMMENT ON COLUMN car.photo IS
    'Fénykép';

ALTER TABLE car ADD CONSTRAINT car_pk PRIMARY KEY ( car_id );

CREATE TABLE car_category (
    car_category             VARCHAR2(2) NOT NULL,
    car_category_description VARCHAR2(150) NOT NULL
);

COMMENT ON TABLE car_category IS
    'Nyilvántartott gépjármű típusok megnevezése';

COMMENT ON COLUMN car_category.car_category IS
    'Gépjármű típusa (B, P, ...)';

COMMENT ON COLUMN car_category.car_category_description IS
    'Gépjármű típus leírása';

ALTER TABLE car_category ADD CONSTRAINT car_category_pk PRIMARY KEY ( car_category );

CREATE TABLE car_description (
    car_id             NUMBER NOT NULL,
    manufacturing_year NUMBER NOT NULL,
    car_description    VARCHAR2(150) NOT NULL,
    car_category       VARCHAR2(2) NOT NULL,
    transmission_type  VARCHAR2(2) NOT NULL,
    fuel_type          CHAR(1) NOT NULL,
    engine_power       NUMBER,
    air_conditining    VARCHAR2(1),
    gps                VARCHAR2(1),
    number_of_doors    NUMBER,
    number_of_seats    NUMBER,
    packages           VARCHAR2(20),
    rental_fee         NUMBER
);

COMMENT ON TABLE car_description IS
    'A bérlehető gépjárművek részletes adatait tartjuk nyilván a táblában';

COMMENT ON COLUMN car_description.car_id IS
    'Gépjármű egyedi azonosítója';

COMMENT ON COLUMN car_description.manufacturing_year IS
    'Gyártási év';

COMMENT ON COLUMN car_description.car_description IS
    'Gépjármű típusának leírása';

COMMENT ON COLUMN car_description.car_category IS
    'Gépjármű típusának megnevezése';

COMMENT ON COLUMN car_description.transmission_type IS
    'Sebességváltó típusa';

COMMENT ON COLUMN car_description.fuel_type IS
    'Üzemanyag típusa';

COMMENT ON COLUMN car_description.engine_power IS
    'Motor teljesítménye';

COMMENT ON COLUMN car_description.air_conditining IS
    'Légkondícionáló';

COMMENT ON COLUMN car_description.gps IS
    'GPS';

COMMENT ON COLUMN car_description.number_of_doors IS
    'Ajtók száma';

COMMENT ON COLUMN car_description.number_of_seats IS
    'Ülések száma';

COMMENT ON COLUMN car_description.packages IS
    'Elhelyezhető csomagok';

COMMENT ON COLUMN car_description.rental_fee IS
    'Bérleti díj összege / nap';

ALTER TABLE car_description ADD CONSTRAINT car_description_pk PRIMARY KEY ( car_id );

CREATE TABLE car_status (
    status_id          CHAR(1) NOT NULL,
    status_description VARCHAR2(100) NOT NULL
);

COMMENT ON COLUMN car_status.status_id IS
    'Autó státuszok azonosítója';

COMMENT ON COLUMN car_status.status_description IS
    'Autó státuszok leírása (elérhető/ bérelhető, megsérült, szervíz alatt, bérlés alatt)';

ALTER TABLE car_status ADD CONSTRAINT car_status_pk PRIMARY KEY ( status_id );

CREATE TABLE employee (
    employee_id NUMBER NOT NULL,
    first_name  NVARCHAR2(100) NOT NULL,
    middle_name NVARCHAR2(100),
    last_name   NVARCHAR2(100) NOT NULL,
    work_since  DATE NOT NULL,
    work_until  DATE
);

COMMENT ON TABLE employee IS
    'A tábla a munkavállalók adatait tartalmazza';

COMMENT ON COLUMN employee.employee_id IS
    'Munkavállaó egyedi azonosítója';

COMMENT ON COLUMN employee.first_name IS
    'Munkavállaló keresztneve';

COMMENT ON COLUMN employee.middle_name IS
    'Munkavállaló középső neve';

COMMENT ON COLUMN employee.last_name IS
    'Munkavállaló vezetékneve';

COMMENT ON COLUMN employee.work_since IS
    'Munkavállalás kezdete';

COMMENT ON COLUMN employee.work_until IS
    'Munkavállalás vége';

ALTER TABLE employee ADD CONSTRAINT employee_pk PRIMARY KEY ( employee_id );

CREATE TABLE fuel_type (
    fuel_type_id          CHAR(1) NOT NULL,
    fuel_type_description VARCHAR2(150) NOT NULL
);

COMMENT ON TABLE fuel_type IS
    'Nyilvántartott üzemanyagtípusok megnevezése';

COMMENT ON COLUMN fuel_type.fuel_type_id IS
    'Üzemeanyagtípus (benzin, dízel, hibrid, elektromos) azonosítója';

COMMENT ON COLUMN fuel_type.fuel_type_description IS
    'Üzemanyagtípus megnevezése';

ALTER TABLE fuel_type ADD CONSTRAINT fuel_type_pk PRIMARY KEY ( fuel_type_id );

CREATE TABLE history (
    car_id      NUMBER NOT NULL,
    contract_id VARCHAR2(20) NOT NULL,
    date_from   DATE NOT NULL,
    date_to     DATE NOT NULL,
    incident_id NUMBER
);

COMMENT ON TABLE history IS
    'Gépjármű bérlések historikus adatait tároljuk a táblában.';

COMMENT ON COLUMN history.car_id IS
    'Gépjármű egyedi azonosítója';

COMMENT ON COLUMN history.contract_id IS
    'Bérleti szerződés egyedi azonosítója';

COMMENT ON COLUMN history.date_from IS
    'Szerződés kezdete';

COMMENT ON COLUMN history.date_to IS
    'Szerződés vége dátum';

COMMENT ON COLUMN history.incident_id IS
    'Káresemény azonosítója';

ALTER TABLE history ADD CONSTRAINT history_pk PRIMARY KEY ( car_id,
                                                            contract_id );

CREATE TABLE incidents (
    incident_id          NUMBER NOT NULL,
    car_id               NUMBER NOT NULL,
    incident_description VARCHAR2(500),
    contract_id          VARCHAR2(20),
    damage_value         NUMBER
);

COMMENT ON TABLE incidents IS
    'A bérleti szerződés hatálya alatt keletkezett károk adatait tároljuk a táblában.';

COMMENT ON COLUMN incidents.incident_id IS
    'A tábla egyedi azonosítója';

COMMENT ON COLUMN incidents.car_id IS
    'Az autó egyedi azonosítója';

COMMENT ON COLUMN incidents.incident_description IS
    'Káresemény leírása';

COMMENT ON COLUMN incidents.contract_id IS
    'Bérleti szerződés egyei azonosítója, amely szerződés időtartama alatt a káresemény történt.';

COMMENT ON COLUMN incidents.damage_value IS
    'Kár mértéke (Forint)';

ALTER TABLE incidents ADD CONSTRAINT incidents_pk PRIMARY KEY ( incident_id );

CREATE TABLE profile (
    profile_id           NUMBER NOT NULL,
    user_name            VARCHAR2(100) NOT NULL,
    email_address        VARCHAR2(100) NOT NULL,
    phone_number         VARCHAR2(100),
    date_of_registration DATE NOT NULL,
    status               VARCHAR2(5),
    pwd                  VARCHAR2(500),
    city                 VARCHAR2(150),
    postcode             VARCHAR2(15),
    street               VARCHAR2(200),
    date_of_birth        DATE,
    first_name           VARCHAR2(100),
    last_name            VARCHAR2(100)
);

COMMENT ON TABLE profile IS
    'A táblában a regisztrált felhasználók adatait tároljuk. Regisztráció során csak a felhasználónév, email cím, jelszó és a regisztráció dátuma kerül kitöltésre. A többi mezőt abban az esetben töltjük, amikor az első autóbérlés megtörténik.'
    ;

COMMENT ON COLUMN profile.profile_id IS
    'Regisztrált felhasználó egyedi azonosítója';

COMMENT ON COLUMN profile.user_name IS
    'Felhasználónév';

COMMENT ON COLUMN profile.email_address IS
    'Regisztráció során megadott email cím';

COMMENT ON COLUMN profile.phone_number IS
    'Telefonszám';

COMMENT ON COLUMN profile.date_of_registration IS
    'Regisztráció időpontja';

COMMENT ON COLUMN profile.status IS
    'Regisztrált profil státusza';

COMMENT ON COLUMN profile.pwd IS
    'Jelszó (titkosítottan tárolt)';

COMMENT ON COLUMN profile.city IS
    'Város';

COMMENT ON COLUMN profile.postcode IS
    'Irányítószám';

COMMENT ON COLUMN profile.street IS
    'Utca, házszám és további címadatok';

COMMENT ON COLUMN profile.date_of_birth IS
    'Születési dátum';

COMMENT ON COLUMN profile.first_name IS
    'Keresztnév';

COMMENT ON COLUMN profile.last_name IS
    'Vezetéknév';

ALTER TABLE profile ADD CONSTRAINT profile_pk PRIMARY KEY ( profile_id );

CREATE TABLE profile_x_contract_x_car (
    profile_id  NUMBER NOT NULL,
    car_id      NUMBER NOT NULL,
    contract_id VARCHAR2(20) NOT NULL
);

COMMENT ON TABLE profile_x_contract_x_car IS
    'A táblában a regisztrált felhasználók adatait kötjük össze a bérlési adatokkal.';

COMMENT ON COLUMN profile_x_contract_x_car.profile_id IS
    'Regisztrált felhasználó egyedi azonosítója';

COMMENT ON COLUMN profile_x_contract_x_car.car_id IS
    'Bérelt autó egyedi azonosítója';

COMMENT ON COLUMN profile_x_contract_x_car.contract_id IS
    'Szerződés egyedi azonosítója';

ALTER TABLE profile_x_contract_x_car ADD CONSTRAINT profile_x_contract_x_car_pk PRIMARY KEY ( profile_id,
                                                                                              contract_id );

CREATE TABLE transmission (
    transmission_type_id          VARCHAR2(2) NOT NULL,
    transmission_type_description VARCHAR2(150) NOT NULL
);

COMMENT ON TABLE transmission IS
    'Nyilvántartott sebességváltó fajták';

COMMENT ON COLUMN transmission.transmission_type_id IS
    'Sebességváltó típus azonosítója';

COMMENT ON COLUMN transmission.transmission_type_description IS
    'Sebességváltó fajta (automata, kézi) leírása';

ALTER TABLE transmission ADD CONSTRAINT transmission_pk PRIMARY KEY ( transmission_type_id );

ALTER TABLE admin
    ADD CONSTRAINT admin_employee_fk FOREIGN KEY ( employee_id )
        REFERENCES employee ( employee_id );

ALTER TABLE admin
    ADD CONSTRAINT admin_profile_fk FOREIGN KEY ( profile_id )
        REFERENCES profile ( profile_id );

ALTER TABLE car_description
    ADD CONSTRAINT car_desc_car_category_fk FOREIGN KEY ( car_category )
        REFERENCES car_category ( car_category );

ALTER TABLE car_description
    ADD CONSTRAINT car_desc_car_fk FOREIGN KEY ( car_id )
        REFERENCES car ( car_id );

ALTER TABLE car_description
    ADD CONSTRAINT car_desc_fuel_type_fk FOREIGN KEY ( fuel_type )
        REFERENCES fuel_type ( fuel_type_id );

ALTER TABLE car_description
    ADD CONSTRAINT car_desc_transmission_fk FOREIGN KEY ( transmission_type )
        REFERENCES transmission ( transmission_type_id );

ALTER TABLE car
    ADD CONSTRAINT car_status_fk FOREIGN KEY ( status )
        REFERENCES car_status ( status_id );

ALTER TABLE history
    ADD CONSTRAINT history_car_fk FOREIGN KEY ( car_id )
        REFERENCES car ( car_id );

ALTER TABLE incidents
    ADD CONSTRAINT incident_car_fk FOREIGN KEY ( car_id )
        REFERENCES car ( car_id );

ALTER TABLE profile_x_contract_x_car
    ADD CONSTRAINT pcc_car_fk FOREIGN KEY ( car_id )
        REFERENCES car ( car_id );

ALTER TABLE profile_x_contract_x_car
    ADD CONSTRAINT pcc_profile_fk FOREIGN KEY ( profile_id )
        REFERENCES profile ( profile_id );



-- Oracle SQL Developer Data Modeler Summary Report: 
-- 
-- CREATE TABLE                            12
-- CREATE INDEX                             0
-- ALTER TABLE                             23
-- CREATE VIEW                              0
-- ALTER VIEW                               0
-- CREATE PACKAGE                           0
-- CREATE PACKAGE BODY                      0
-- CREATE PROCEDURE                         0
-- CREATE FUNCTION                          0
-- CREATE TRIGGER                           0
-- ALTER TRIGGER                            0
-- CREATE COLLECTION TYPE                   0
-- CREATE STRUCTURED TYPE                   0
-- CREATE STRUCTURED TYPE BODY              0
-- CREATE CLUSTER                           0
-- CREATE CONTEXT                           0
-- CREATE DATABASE                          0
-- CREATE DIMENSION                         0
-- CREATE DIRECTORY                         0
-- CREATE DISK GROUP                        0
-- CREATE ROLE                              0
-- CREATE ROLLBACK SEGMENT                  0
-- CREATE SEQUENCE                          0
-- CREATE MATERIALIZED VIEW                 0
-- CREATE MATERIALIZED VIEW LOG             0
-- CREATE SYNONYM                           0
-- CREATE TABLESPACE                        0
-- CREATE USER                              0
-- 
-- DROP TABLESPACE                          0
-- DROP DATABASE                            0
-- 
-- REDACTION POLICY                         0
-- 
-- ORDS DROP SCHEMA                         0
-- ORDS ENABLE SCHEMA                       0
-- ORDS ENABLE OBJECT                       0
-- 
-- ERRORS                                   0
-- WARNINGS                                 0
